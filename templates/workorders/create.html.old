{% extends "base.html" %}

{% block content %}

<form action='' method="POST">
  {% csrf_token %}

 <!-- <div id="testing" hx-trigger="CustomerAdded from:body" hx-refresh="True" hx-get="{% url 'customers:customer_list' %}" hx-target="#custlist">
</div> -->
<div id="workorder">
  {% include 'workorders/partials/workorder.html' %}
</div>

<div id="custlist">
  {% include 'customers/partials/customers.html' %}
</div>

<!-- <a href="#" data-bs-toggle="modal" data-bs-target="#NewCustomerModal">Add New Customer</a> -->
<br/>

<button hx-get="{% url 'customers:new_customer' %}" hx-target="#dialog">
  Add New Customer
</button>

<p>

  

  <div id="contacts">
  {% include 'customers/partials/contacts.html' %}
  </div>

 
  <button style='margin-top:10px;' type='submit'>Save</button>

</form>
            
          
            

          
  

  <!-- <div id="base">
{% include 'customers/partials/customer_info.html' %}

</div> -->





<div id="modal" class="modal fade">
  <div id="dialog" class="modal-dialog" hx-target="this"></div>
</div>

<div id="modal" class="modal fade">
  <div id="contactdialog" class="modal-dialog" hx-target="this"></div>
</div>





















<!-- <a href="#" data-bs-toggle="modal" data-bs-target="#testModal">Link to open modal</a>
<br/>
 Button trigger modal 
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#testModal">
    Add New Customer
  </button> > -->
<hr>

<div class="row">
    <div class="col-md-5 mb-sm-0">
        <div class="card">
            <div class="card-header">
            Customer Info
            </div>
            <div class="card-body">
            <h5 class="card-title">Invoice #:</h5>
            <p class="card-text">
                Date Created:<br/>
                Date Due:<br/>
            </div>
            <div class="card-footer"></div>
        </div>
    </div>
    <div class="col-md-5">
        <div class="card">
            <div class="card-header">
            Workorder Info
            </div>
            <div class="card-body">
                <h5 class="card-title">Invoice #:</h5>
                <p class="card-text">
                    Date Created:<br/>
                    Date Due:<br/>
                    <p class="card-text">
                        LK Workorder #:
        Printleader #:
            </div>
            <div class="card-footer"></div>
        </div>
    </div>
</div>


<div class="container text-center">
    <div class="row">
        <div class="col">
        Customer
        <br/>
        <br/>
        </div>
        <div class="col">
        
        </div>
        <div class="col">
        
        LK Workorder #:
        Printleader #:

        </div>
    </div>
    <div class="row">
      <div class="col">
        Shipping Address: <a href="#" data-bs-toggle="modal" data-bs-target="#shippingModal">Change Shipping</a><br/>
        123 Any Street<br/>
        City, State, Zipcode<br/>
      </div>
      <div class="col">
        Billing Address:<a href="#" data-bs-toggle="modal" data-bs-target="#billingModal">Change Billing</a><br/>
        123 Any Street<br/>
        City, State, Zipcode<br/>
      </div>
      <div class="col">
        Contact:<a href="#" data-bs-toggle="modal" data-bs-target="#contactModal">Change Contact</a><br/>
        Phone:<br/>
        Email:<br/>
      </div>
    </div>
  </div>










  <div class="modal fade" id="NewCustomerModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  
    <div class="modal-dialog">
      <form hx-post="" hx-swap='outerHTML' hx-headers='{"X-CSRFToken":"{{ csrf_token }}"}' class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">New Customer Modal</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">

          {% if message %}

          <p>{{ message }}</p>
  
          {% endif %}
      
          {% csrf_token %}
          
  
          {% for field in newcustomerform %}
  
          
          <div class='{% if field.field.required %}{{ form.required_css_class }}{% endif %}'>
              {{ field.errors }}
              {{ field.label_tag }} {{ field }}
              {% if field.help_text %}
                  <p class="help">{{ field.help_text|safe }}</p>
              {% endif %}
          </div>
          {% endfor %}
  
  
          <div id='empty-form' class='hidden'>{{ formset.empty_form.as_p }}</div>
  
          <!-- <button id='add-more' type='button'>Add more</button> -->
  
          
          <div class='htmx-indicator'>Loading...</div>
          <button class='htmx-inverted-indicator' style='margin-top:10px;' type='submit' data-bs-dismiss="modal">Save</button>
  
          {% if message %}
  
          <p>{{ message }}</p>
  
          {% endif %}
          
         

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-primary" type='submit' data-bs-dismiss="modal">Save changes</button>
        </div>
      
    </div>
 
  </div>
</form>

<!-- Modal -->


  <!-- Modal -->
<div class="modal fade" id="billingModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">Billing Modal</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          ...
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Save changes</button>
        </div>
      </div>
    </div>
  </div>

    <!-- Modal -->
<div class="modal fade" id="contactModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">Contact Modal</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          ...
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Save changes</button>
        </div>
      </div>
    </div>
  </div>


























  
  <!-- Modal -->
  <div class="modal fade" id="testModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          ...
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Save changes</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-bs-toggle="modal" data-bs-target="#exampleModal">Other</button>
        </div>
      </div>
    </div>
  </div>


<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">New Modal</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          ...
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Save changes</button>
        </div>
      </div>
    </div>
  </div>
  
  


{% endblock content %}


{% block scripts %}

<script>

    $(document).ready(function () {
      $("#id_customer").select2();
      $('#id_customer').on('select2:select', (e) => {
        htmx.trigger("#id_customer", "change")
      });
    })

    htmx.on("htmx:afterSwap", (e) => {
      $("#id_customer").select2();
      // Response targeting #dialog => show the modal
      $('#id_customer').on('select2:select', (e) => {
        htmx.trigger("#id_customer", "change")
      });
    })

    /*document.body.addEventListener('htmx:afterRequest', function(evt) {
      $("#id_customer").select2();
      $('#id_customer').on('select2:select', (e) => {
        htmx.trigger("#id_customer", "change")
      });*/

    const modal = new bootstrap.Modal(document.getElementById("modal"))

    htmx.on("htmx:afterSwap", (e) => {
      // Response targeting #dialog => show the modal
      if (e.detail.target.id == "dialog") {
        modal.show()
      }
    })

    htmx.on("htmx:beforeSwap", (e) => {
      // Empty response targeting #dialog => hide the modal
      if (e.detail.target.id == "dialog" && !e.detail.xhr.response) {
        modal.hide()
        e.detail.shouldSwap = false
      }
    })

    htmx.on("hidden.bs.modal", () => {
      document.getElementById("dialog").innerHTML = ""
    })
    
    


</script>

{% endblock %}