{% load crispy_forms_tags %}
{% load form_extras %}
{% load static %}

<h1>Details:</h1><br/>

<form action="" method="POST">
  {% csrf_token %}
  <input type="hidden" name="master_id" value="{{ master.pk }}">

  <table style="width:90%; border-collapse:collapse; border:1px solid #ccc;">
    <thead>
      <tr style="background:#f5f5f5;">
        <th style="border:1px solid #ccc; padding:8px;">Item Info</th>
        <th style="border:1px solid #ccc; padding:8px;">Item Type</th>
        <th style="border:1px solid #ccc; padding:8px;">Item Category</th>
        <th style="border:1px solid #ccc; padding:8px;">Retail Item</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <!-- Item Info sidebar -->
        <td style="vertical-align:top; border:1px solid #ccc; padding:10px; background:#fafafa;" rowspan="7">
          <strong>Internal part number:</strong> {{ master.pk }}<br>
          <strong>Description:</strong> {{ master.description }}<br>
          <strong>Primary Vendor:</strong> {{ master.primary_vendor }}<br>
          <strong>Primary Vendor p/n:</strong> {{ master.primary_vendor_part_number }}<br>
          <strong>Primary Base Unit:</strong> {{ master.primary_base_unit }}<br>
          <strong>High Price:</strong> {{ master.high_price }}<br>
        </td>

        <!-- First type -->
        <td style="border:1px solid #ccc; padding:8px;">
          {% if form %}{{ form|as_bound:"type_paper"|as_crispy_field }}{% endif %}
        </td>

        <!-- Category + Retail -->
        <td style="vertical-align:top; border:1px solid #ccc; padding:8px;" rowspan="7">
          {% if form %}{{ form|as_bound:"inventory_category"|as_crispy_field }}{% endif %}
          <br>
          <button type="submit" class="btn btn-secondary" style="margin-top:30px;">Submit</button>
        </td>
        <td style="vertical-align:top; border:1px solid #ccc; padding:8px;" rowspan="7">
          {% if form %}{{ form|as_bound:"retail_item"|as_crispy_field }}{% endif %}
        </td>
      </tr>

      <!-- Remaining types -->
      <tr><td style="border:1px solid #ccc; padding:8px;">{% with f=form|as_bound:"type_envelope" %}{{ f|as_crispy_field }}{% endwith %}</td></tr>
      <tr><td style="border:1px solid #ccc; padding:8px;">{% with f=form|as_bound:"type_wideformat" %}{{ f|as_crispy_field }}{% endwith %}</td></tr>
      <tr><td style="border:1px solid #ccc; padding:8px;">{% with f=form|as_bound:"type_vinyl" %}{{ f|as_crispy_field }}{% endwith %}</td></tr>
      <tr><td style="border:1px solid #ccc; padding:8px;">{% with f=form|as_bound:"type_mask" %}{{ f|as_crispy_field }}{% endwith %}</td></tr>
      <tr><td style="border:1px solid #ccc; padding:8px;">{% with f=form|as_bound:"type_laminate" %}{{ f|as_crispy_field }}{% endwith %}</td></tr>
      <tr><td style="border:1px solid #ccc; padding:8px;">{% with f=form|as_bound:"type_substrate" %}{{ f|as_crispy_field }}{% endwith %}</td></tr>
    </tbody>
  </table>
</form>

<hr>
Items history
<p>
  <table class="table table-bordered">
    <thead>
      <tr>
        <td>PK</td>
        <td>Invoice date</td>
        <td>Invoice Number</td>
        <td>Invoice Qty</td>
        <td>Invoice Unit</td>
        <td>Invoice Unit Cost</td>
        <td>Line Total</td>
        <td>Vendor</td>
        <td>Vendor Part Number</td>
      </tr>
    </thead>
    <tbody>
      {% for x in history %}
        <tr>
          <td>{{ x.pk }}</td>
          <td>{{ x.invoice.invoice_date }}</td>
          <td>{{ x.invoice.invoice_number }}</td>
          <td>{{ x.invoice_qty }}</td>
          <td>{{ x.invoice_unit.variation }}</td>
          <td>{{ x.invoice_unit_cost }}</td>
          <td>{{ x.line_total }}</td>
          <td>{{ x.vendor }}</td>
          <td>{{ x.vendor_part_number }}</td>
        </tr>
      {% empty %}
        <tr><td colspan="9" class="text-muted">No purchase history.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</p>