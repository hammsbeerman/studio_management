{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% load static %}

{% block content %}


<h1>Item details</h1>
<br/>

<form action='/inventory/item_details' method="POST">
    {% csrf_token %}


    <!-- {{ form.as_p }}
        <input type="hidden" id="invoice" name="invoice" value="{{ invoice }}">
        <input type="hidden" id="vendor" name="vendor" value="{{ vendor }}">
        <button type="submit">Save</button>
</form> -->
<div class="container">
  <div class="row">
    <div class="col-sm-10">
      <select class="custom-select mb-4" id="id_name" hx-trigger="change" name="name" hx-get="{% url 'inventory:item_details' %}" hx-target="#remainder">
        <option selected>Select Item</option>
        {% for x in items %}
          <option value="{{ x.id }}">{{ x.name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-sm-2">  
      
    </div>
  </div>
</div>
<div id="remainder">
    <h1>Details:</h1></br>
<form action="/inventory/item_details/" method="POST">
  {% csrf_token %}
  <input type="hidden" name="master_id" value="{{ master.pk }}">

  <table style="width:90%; border-collapse:collapse; border:1px solid #ccc;">
    <thead>
      <tr style="background:#f5f5f5;">
        <th style="border:1px solid #ccc; padding:8px;">Item Info</th>
        <th style="border:1px solid #ccc; padding:8px;">Item Type</th>
        <th style="border:1px solid #ccc; padding:8px;">Item Category</th>
        <th style="border:1px solid #ccc; padding:8px;">Retail Item</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <!-- Item Info sidebar -->
        <td style="vertical-align:top; border:1px solid #ccc; padding:10px; background:#fafafa;" rowspan="7">
          <strong>Internal part number:</strong> {{ master.pk }}<br>
          <strong>Description:</strong> {{ master.description }}<br>
          <strong>Primary Vendor:</strong> {{ master.primary_vendor }}<br>
          <strong>Primary Vendor p/n:</strong> {{ master.primary_vendor_part_number }}<br>
          <strong>Primary Base Unit:</strong> {{ master.primary_base_unit }}<br>
          <strong>High Price:</strong> {{ master.high_price }}<br>
        </td>

        <!-- First type -->
        <td style="border:1px solid #ccc; padding:8px;">{{ form.type_paper|as_crispy_field }}</td>

        <!-- Category + Retail -->
        <td style="vertical-align:top; border:1px solid #ccc; padding:8px;" rowspan="7">
          {{ form.inventory_category }}
          <br>
          <button type="submit" class="btn btn-secondary" style="margin-top:30px;">
            Submit
            </button>
        </td>
        <td style="vertical-align:top; border:1px solid #ccc; padding:8px;" rowspan="7">
          {{ form.retail_item }}
        </td>
      </tr>

      <!-- Remaining types -->
      <tr><td style="border:1px solid #ccc; padding:8px;">{{ form.type_envelope|as_crispy_field }}</td></tr>
      <tr><td style="border:1px solid #ccc; padding:8px;">{{ form.type_wideformat|as_crispy_field }}</td></tr>
      <tr><td style="border:1px solid #ccc; padding:8px;">{{ form.type_vinyl|as_crispy_field }}</td></tr>
      <tr><td style="border:1px solid #ccc; padding:8px;">{{ form.type_mask|as_crispy_field }}</td></tr>
      <tr><td style="border:1px solid #ccc; padding:8px;">{{ form.type_laminate|as_crispy_field }}</td></tr>
      <tr><td style="border:1px solid #ccc; padding:8px;">{{ form.type_substrate|as_crispy_field }}</td></tr>
    </tbody>
  </table>

</form>


<hr>
Items history
<p>
    

    <table class="table table-bordered">
        <thead>
            <tr>
                <td>PK</td>
                <td>Invoice date</td>
                <td>Invoice Number</td>
                <td>Invoice Qty</td>
                <td>Invoice Unit</td>
                <td>Invoice Unit Cost</td>
                <td>Line Total</td>
                <td>Vendor</td>
                <td>Vendor Part Number</td>
            </tr>
        </thead>
        {% for x in item %}
            <tr>
                <td>{{x.pk}}</td>
                <td>{{x.invoice.invoice_date}}</td>
                <td>{{x.invoice.invoice_number}}</td>
                <td>{{x.invoice_qty}}</td>
                <td>{{x.invoice_unit.variation}}</td>
                <td>{{x.invoice_unit_cost}}</td>
                <td>{{x.line_total}}</td>
                <td>{{x.vendor}}</td>
                <td>{{x.vendor_part_number}}</td>
            </tr>
        {% endfor %}
    </table>
</div>


  {% endblock content %}

{% block scripts %}

<script>

    $(document).ready(function () {
      $("#id_name").select2();
      $('#id_name').on('select2:select', (e) => {
        htmx.trigger("#id_name", "change")
      });
    })

    

</script>

{% endblock %}