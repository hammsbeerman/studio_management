{% extends "base.html" %}
{% load static %}

{% block content %}
<script src="{% static 'js/order_out_form.js' %}"></script>
<script src="{% static 'js/setprice_form.js' %}"></script>

<div class="row">
  <div class="col-sm-12">
    <select
      class="custom-select mb-4"
      id="customer"
      name="customer"
      hx-get="{% url 'customers:expanded_detail' %}"
      hx-trigger="change"
      hx-target="#customer_detail"
      hx-swap="innerHTML"
    >
      <option value="" selected>Select Customer</option>
      {% for x in customers %}
        <option value="{{ x.id }}">{{ x.company_name }}</option>
      {% endfor %}
    </select>
  </div>
</div>

<div id="customer_detail"></div>

<div id="modal" class="modal fade">
  <div id="dialog" class="modal-dialog" hx-target="this"></div>
</div>

<div id="modal2" class="modal fade">
  <div id="dialog2" class="modal-dialog modal-lg" hx-target="this"></div>
</div>
{% endblock content %}

{% block scripts %}
<script>
  function initCustomerSelect() {
    const el = document.getElementById("customer");
    if (!el || !window.jQuery || !$.fn.select2) return;

    const $el = $(el);

    // prevent double init
    if ($el.hasClass("select2-hidden-accessible")) return;

    $el.select2({ width: "100%" });

    // make select2 actually trigger htmx change
    $el.on("select2:select", function () {
      this.dispatchEvent(new Event("change", { bubbles: true }));
    });
  }

  document.addEventListener("DOMContentLoaded", initCustomerSelect);
  document.addEventListener("htmx:load", (e) => initCustomerSelect());
</script>

{# IMPORTANT: removed the old ContactChanged JS that used outerHTML and broke the card #}
{% endblock %}