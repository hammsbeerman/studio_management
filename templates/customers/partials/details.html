{% load static %}

<script>
  $(document).ready(function () {
    $("#customer").select2();
    $('#customer').on('select2:select', () => htmx.trigger("#customer", "change"));
  });
</script>

<select
  class="custom-select mb-4"
  id="customer"
  name="customers"
  hx-get="{% url 'customers:expanded_detail' %}"
  hx-target="#customers"
  hx-trigger="change"
>
  {% if customer %}
    <option value="{{ customer.id }}" selected>{{ customer }}</option>
  {% else %}
    <option value="" selected>Select Customer</option>
  {% endif %}
  {% for x in customers %}
    <option value="{{ x.id }}">{{ x.company_name }}</option>
  {% endfor %}
</select>

{% if customer %}

<ul class="nav nav-tabs" id="customerTabs" role="tablist">
  <li class="nav-item" role="presentation">
    <button class="nav-link active" id="tab-overview" data-bs-toggle="tab" data-bs-target="#pane-overview" type="button" role="tab">
      Overview
    </button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="tab-open" data-bs-toggle="tab" data-bs-target="#pane-open" type="button" role="tab">
      Open
    </button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="tab-completed" data-bs-toggle="tab" data-bs-target="#pane-completed" type="button" role="tab">
      Completed
    </button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="tab-quotes" data-bs-toggle="tab" data-bs-target="#pane-quotes" type="button" role="tab">
      Quotes
    </button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="tab-payments" data-bs-toggle="tab" data-bs-target="#pane-payments" type="button" role="tab">
      Payments
    </button>
  </li>
</ul>

<div class="tab-content pt-3">

  <!-- OVERVIEW -->
  <div class="tab-pane fade show active" id="pane-overview" role="tabpanel" aria-labelledby="tab-overview">
    <div class="row">
      <div class="col-md-3 mb-sm-0">
        <div id="customer-info-card" class="card"
             hx-trigger="CustomerAdded from:body"
             hx-get="{% url 'customers:cust_info' %}?customer={{ customer.id }}"
             hx-target="this">
          {% include 'customers/partials/customer_info.html' %}
        </div>
      </div>

      <div class="col-md-3">
        <div id="contact-card" class="card"
             hx-trigger="ContactChanged from:body"
             hx-get="{% url 'customers:details_contact_info' %}?customer={{ customer.id }}{% if contact %}&contact={{ contact.id }}{% endif %}"
             hx-target="this">
          {% include 'customers/partials/details_contact_info.html' %}
        </div>
      </div>

      <div class="col-md-3">
        <div class="card">
          <div class="card-header">Financial Details</div>
          <div class="card-body">
            {% include 'workorders/partials/finance.html' %}
          </div>
        </div>
      </div>

      <div class="col-md-3">
        <div class="card">
          <div class="card-header">Customer Order History</div>
          <div class="card-body">
            {% include 'workorders/partials/workorder_history.html' %}
          </div>
        </div>
      </div>
    </div>

    {% include 'customers/partials/icon_legend.html' %}
  </div>

  <!-- OPEN -->
  <div class="tab-pane fade" id="pane-open" role="tabpanel" aria-labelledby="tab-open"
       hx-get="{% url 'customers:customer_tab_open' customer.id %}"
       hx-trigger="shown.bs.tab from:#tab-open once"
       hx-target="this">
    <div class="text-muted p-3">Loading…</div>
  </div>

  <!-- COMPLETED -->
  <div class="tab-pane fade" id="pane-completed" role="tabpanel" aria-labelledby="tab-completed"
       hx-get="{% url 'customers:customer_tab_completed' customer.id %}"
       hx-trigger="shown.bs.tab from:#tab-completed once"
       hx-target="this">
    <div class="text-muted p-3">Loading…</div>
  </div>

  <!-- QUOTES -->
  <div class="tab-pane fade" id="pane-quotes" role="tabpanel" aria-labelledby="tab-quotes"
       hx-get="{% url 'customers:customer_tab_quotes' customer.id %}"
       hx-trigger="shown.bs.tab from:#tab-quotes once"
       hx-target="this">
    <div class="text-muted p-3">Loading…</div>
  </div>

  <!-- PAYMENTS -->
  <div class="tab-pane fade" id="pane-payments" role="tabpanel" aria-labelledby="tab-payments"
       hx-get="{% url 'customers:customer_tab_payments' customer.id %}"
       hx-trigger="shown.bs.tab from:#tab-payments once"
       hx-target="this">
    <div class="text-muted p-3">Loading…</div>
  </div>

</div>
{% endif %}