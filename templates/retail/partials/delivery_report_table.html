<table class="table table-sm table-striped align-middle">
  <thead>
    <tr>
      <th>#</th>
      <th>Customer</th>
      <th>Sale / Workorder</th>
      <th>Delivered</th>
      <th>Delivery Date</th>
      <th>Notes</th>
      <th>Move</th>
    </tr>
  </thead>
  <tbody>
    {% if deliveries %}
      {% for d in deliveries %}
        <tr>
          <td>{{ forloop.counter }}</td>

          <td>
            {% if d.customer %}
              <a
                href="#"
                hx-get="{% url 'customers:edit_customer' %}?customer={{ d.customer.id }}"
                hx-target="#dialog"
                hx-swap="innerHTML"
                data-bs-toggle="modal"
                data-bs-target="#modal"
              >
                {{ d.customer.company_name }}
              </a>
            {% else %}
              <span class="text-muted">No customer</span>
            {% endif %}
          </td>

          <td>
            {% if d.workorder %}
              <a href="{% url 'workorders:overview' id=d.workorder.workorder %}">
                WO {{ d.workorder.workorder }}
              </a>
            {% elif d.sale %}
              Sale #{{ d.sale.id }}
            {% else %}
              <span class="text-muted">N/A</span>
            {% endif %}
          </td>

          {# Delivered checkbox #}
          <td class="text-center">
            <input
              type="hidden"
              name="delivery_id"
              value="{{ d.id }}"
            >
            <input
              type="hidden"
              name="date"
              value="{{ selected_date|date:'Y-m-d' }}"
            >
            <input
              type="checkbox"
              aria-label="Mark delivered"
              hx-post="{% url 'retail:delivery_mark_delivered' %}"
              hx-target="#delivery-report-table"
              hx-swap="innerHTML"
              hx-include="closest td"
              hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
            >
          </td>

          {# Delivery date editor #}
          <td style="white-space: nowrap;">
            <input
              type="hidden"
              name="delivery_id"
              value="{{ d.id }}"
            >
            <input
              type="hidden"
              name="current_date"
              value="{{ selected_date|date:'Y-m-d' }}"
            >
            <input
              type="date"
              name="date"
              class="form-control form-control-sm"
              value="{{ d.scheduled_date|date:'Y-m-d' }}"
              hx-post="{% url 'retail:delivery_update_date' %}"
              hx-target="#delivery-report-table"
              hx-swap="innerHTML"
              hx-trigger="change"
              hx-include="closest td"
              hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
            >
          </td>

          <td>{{ d.notes|default_if_none:"" }}</td>

          <td style="white-space: nowrap;">
            <button
              type="button"
              class="btn btn-sm btn-outline-secondary"
              hx-post="{% url 'retail:delivery_reorder' %}"
              hx-vals='{
                "move": "up",
                "delivery_id": "{{ d.id }}",
                "date": "{{ selected_date|date:"Y-m-d" }}"
              }'
              hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
              hx-target="#delivery-report-table"
              hx-swap="innerHTML"
            >
              ↑
            </button>

            <button
              type="button"
              class="btn btn-sm btn-outline-secondary"
              hx-post="{% url 'retail:delivery_reorder' %}"
              hx-vals='{
                "move": "down",
                "delivery_id": "{{ d.id }}",
                "date": "{{ selected_date|date:"Y-m-d" }}"
              }'
              hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
              hx-target="#delivery-report-table"
              hx-swap="innerHTML"
            >
              ↓
            </button>
          </td>
          
        </tr>
      {% endfor %}
    {% else %}
      <tr>
        <td colspan="7" class="text-muted small">
          {% if selected_date %}
            No deliveries scheduled for {{ selected_date|date:"Y-m-d" }}.
          {% else %}
            No deliveries scheduled.
          {% endif %}
        </td>
      </tr>
    {% endif %}
  </tbody>
</table>