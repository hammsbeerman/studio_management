{% extends "base.html" %}

{% block content %}
<h4>Delivery Report</h4>

<form
  id="delivery-report-filter"
  method="get"
  class="mb-3"
  hx-get="{% url 'retail:delivery_report' %}"
  hx-target="#delivery-report-table"
  hx-swap="innerHTML"
  hx-trigger="change from:#delivery-report-date"
>
  <label class="form-label small mb-1">Filter by date</label>
  <div class="input-group input-group-sm" style="max-width: 260px;">
    <input
      type="date"
      name="date"
      id="delivery-report-date"
      class="form-control"
      value="{{ selected_date|date:'Y-m-d' }}"
    >
    <button class="btn btn-outline-secondary" type="submit">
      Apply
    </button>
  </div>
</form>

<div id="delivery-report-table">
  {# HTMX will replace this div's contents when filter/date changes #}
  {% include "retail/partials/delivery_report_table.html" %}
</div>

<div class="modal fade" id="modal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div id="dialog">
      <!-- Customer edit modal content gets swapped in here via HTMX -->
    </div>
  </div>
</div>

{% endblock %}

{% block scripts %}

<script>
  // Close the customer edit modal when the CustomerAdded trigger fires
  document.body.addEventListener("CustomerAdded", function () {
    const modalEl = document.getElementById("modal");
    if (!modalEl) return;

    const modal = bootstrap.Modal.getInstance(modalEl);
    if (modal) {
      modal.hide();
    }
  });
</script>

{% endblock scripts %}