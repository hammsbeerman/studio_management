{% load humanize %}

<div class="modal-content">
  <div class="modal-header">
    <h5 class="modal-title">
      Receipt — Sale #{{ sale.id }}
    </h5>
    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
  </div>

  <div class="modal-body">
    <div id="receipt-print-area">
      <div class="mb-2">
        <strong>Store:</strong> {{ sale.internal_company }}<br>
        {% if cash %}
          <strong>Date:</strong> {{ cash.created_at|date:"Y-m-d H:i" }}<br>
        {% else %}
          <strong>Date:</strong> {{ sale.created_at|date:"Y-m-d H:i" }}<br>
        {% endif %}

        {% if sale.customer %}
          <strong>Customer:</strong> {{ sale.customer }}<br>
        {% elif sale.customer_name %}
          <strong>Customer:</strong> {{ sale.customer_name }}<br>
        {% endif %}
      </div>

      <hr class="my-2">

      <table class="table table-sm mb-2">
        <thead>
          <tr>
            <th>Description</th>
            <th class="text-end">Qty</th>
            <th class="text-end">Price</th>
            <th class="text-end">Total</th>
          </tr>
        </thead>
        <tbody>
          {% for line in lines %}
            <tr>
              <td>{{ line.description }}</td>
              <td class="text-end">{{ line.qty }}</td>
              <td class="text-end">{{ line.unit_price|floatformat:2 }}</td>
              <td class="text-end">{{ line.extended|floatformat:2 }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>

      {% if issued_giftcerts %}
        <hr class="my-2">
        <div class="mb-2">
          <strong>Gift Certificates Issued</strong>
          <ul class="mb-0">
            {% for gc in issued_giftcerts %}
              <li>
                {{ gc.certificate_number }} — {{ gc.original_amount|floatformat:2 }}
              </li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}

      <hr class="my-2">

      <div class="text-end">
        <div>Subtotal: {{ subtotal|floatformat:2 }}</div>
        <div>Tax: {{ tax|floatformat:2 }}</div>
        <div><strong>Total: {{ total|floatformat:2 }}</strong></div>
        {% if cash %}
          <div class="mt-1">
            <small>
              Payment: {{ cash.payment_method }}{% if cash.payment_notes %} — {{ cash.payment_notes }}{% endif %}
            </small>
          </div>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="modal-footer">
    <button type="button" class="btn btn-sm btn-secondary" data-bs-dismiss="modal">
      Close
    </button>
    <button type="button" class="btn btn-sm btn-primary" onclick="window.print()">
      Print
    </button>
    <a href="{% url 'retail:sale_receipt_modal' sale.id %}" target="_blank" class="btn btn-sm btn-outline-secondary">
      Open full receipt
    </a>
  </div>
</div>